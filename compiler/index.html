<html>
    <head></head>
    <body>
        <script>
            const memory = new WebAssembly.Memory({initial: 1});
            fetch('out.wasm').then(response =>
                response.arrayBuffer()
            ).then(bytes =>
            WebAssembly.instantiate(bytes, {
            env: {
                consoleLog: console.log,
            'memoryBase': 0,
            'memory': memory,
            }
       })
            ).then(results => {
            const ptr = results.instance.exports.logString();
            const view = new DataView(results.instance.exports.memory.buffer);
            const len = view.getInt32(ptr, true);
            const strData = new Uint8Array(len)
            for(let i=0;i<len;i++) {
                strData[i] = view.getUint8(ptr+4+i);
            }
            console.log(new TextDecoder().decode(strData));

            console.log(`Add: ${results.instance.exports.add(4,9)}`);
            console.log(`Sub: ${results.instance.exports.sub(5,2)}`);
            const d = Date.now();
            console.log(`Fib: ${results.instance.exports.fib(42)}`);
            console.log(Date.now()-d)
            });
        </script>
    </body>
</html>